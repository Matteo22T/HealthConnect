<div class="whatsapp-container">

  <!-- SIDEBAR -->
  <div class="sidebar">

    <div class="sidebar-header">
      <h3>Lista contatti ({{ listaContatti.length }})</h3>
    </div>

    <div class="contacts-list">

      <div *ngIf="listaContatti.length === 0" style="padding: 20px; color: #e53e3e; text-align: center;">
        ðŸ“‹ Caricamento in corso o lista vuota...
      </div>

      <div *ngFor="let contatto of listaContatti"
           class="contact-item"
           [class.active]="contattoSelezionato?.id === contatto.id"
           (click)="selezionaContatto(contatto)">

        <div class="avatar-circle">
          {{ contatto.nome ? contatto.nome.charAt(0) : '?' }}{{ contatto.cognome ? contatto.cognome.charAt(0) : '?' }}
        </div>

        <div style="display: flex; flex-direction: column; flex: 1;">
          <h4>{{ contatto.nome }} {{ contatto.cognome }}</h4>
          <span>Clicca per chattare</span>
        </div>

      </div>

    </div>
  </div>


  <!-- MAIN CHAT -->
  <div class="main-chat">

    <!-- WELCOME SCREEN -->
    <div *ngIf="!contattoSelezionato" class="welcome-screen">
      <div class="welcome-content">
        <h2>ðŸ’¬ HealthConnect Web</h2>
        <p>Seleziona un medico dalla lista per iniziare a chattare.</p>
      </div>
    </div>

    <!-- CHAT ATTIVA -->
    <div *ngIf="contattoSelezionato" class="chat-wrapper">

      <!-- HEADER CHAT -->
      <div class="chat-header">
        <div class="avatar-circle">
          {{ contattoSelezionato.nome.charAt(0) }}{{ contattoSelezionato.cognome.charAt(0) }}
        </div>
        <h3> {{ contattoSelezionato.nome }} {{ contattoSelezionato.cognome }}</h3>
      </div>

      <!-- BODY MESSAGGI -->
      <div class="chat-body" #scrollContainer>
        <div *ngFor="let msg of messaggi"
             class="message-bubble"
             [ngClass]="{'sent': msg.mittente_id === utenteCorrenteid, 'received': msg.mittente_id !== utenteCorrenteid}">

          <div class="bubble-content">
            <span>{{ msg.testo }}</span>
            <span class="time">
              {{ msg.data_invio | date:'HH:mm' }}
              <!-- Indicatore di lettura solo per messaggi inviati -->
              <span *ngIf="msg.mittente_id === utenteCorrenteid" class="read-status">
                <span class="checkmark" [ngClass]="msg.letto ? 'read' : 'sent'"></span>
              </span>
            </span>
          </div>
        </div>
      </div>

      <!-- FOOTER INPUT -->
      <div class="chat-footer">
        <input type="text"
               [(ngModel)]="nuovoMessaggio"
               (keyup.enter)="invia()"
               placeholder="Scrivi un messaggio..."
               autofocus>
        <button class="btn-send" (click)="invia()">âž¤</button>
      </div>
    </div>

  </div>

</div>
